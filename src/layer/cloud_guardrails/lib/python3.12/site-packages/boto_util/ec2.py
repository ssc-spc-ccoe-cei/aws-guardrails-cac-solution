import logging

import botocore.exceptions

logger = logging.getLogger()
logger.setLevel(logging.INFO)


def get_enabled_regions(ec2_client) -> list[dict]:
    """Get the list of enabled regions
    Returns:
    List of enabled regions
    """
    result = []
    try:
        response = ec2_client.describe_regions(DryRun=False, AllRegions=True)
    except botocore.exceptions.ClientError as ex:
        if "UnauthorizedOperation" in ex.response["Error"]["Code"]:
            logger.error("UnauthorizedOperation when trying to describe regions (EC2)")
        logger.error("Unable to describe regions.")
        raise ex
    for region in response.get("Regions"):
        if region.get("OptInStatus") != "not-opted-in":
            result.append(region.get("RegionName"))
    return result
